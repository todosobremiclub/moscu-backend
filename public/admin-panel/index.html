<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gesti√≥n de Alumnos - Mosc√∫</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #fdf9f6; color: #111; margin: 0; padding: 0; }
    header { background-color: #8b0000; color: white; padding: 1rem; text-align: center; }
    main { padding: 1rem 2rem; }
    .toolbar { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
    .toolbar input, .toolbar select { padding: 0.5rem; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: left; }
    th { background-color: #eee; }
    .acciones button { margin-right: 0.25rem; }
    .boton-nuevo { background-color: #8b0000; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; }
    .boton-nuevo:hover { background-color: #a00000; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 1rem; border-radius: 4px; width: 90%; max-width: 500px; }
    .modal-content h2 { margin-top: 0; }
    .modal-content input, .modal-content label { display: block; width: 100%; margin-bottom: 0.5rem; }
    .modal-content button { margin-top: 1rem; }
  </style>
</head>
<body>
  <header><h1>Gesti√≥n de Alumnos - Teatro Mosc√∫</h1></header>
  <main>
    <div class="toolbar">
      <input type="text" id="busqueda" placeholder="Buscar por nombre, apellido o DNI" />
      <select id="orden">
        <option value="apellido">Ordenar por apellido</option>
        <option value="numero_alumno">Ordenar por n√∫mero</option>
        <option value="dni">Ordenar por DNI</option>
      </select>
      <label><input type="checkbox" id="ver_inactivos" /> Ver inactivos</label>
      <button class="boton-nuevo" onclick="abrirModal()">Nuevo alumno</button>
    </div>

    <table id="tabla-alumnos">
      <thead>
        <tr>
          <th>#</th><th>Nombre</th><th>Apellido</th><th>DNI</th><th>Clase</th>
          <th>Tel√©fono</th><th>Nacimiento</th><th>Ingreso</th><th>Activo</th><th>Foto</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2>Nuevo Alumno</h2>
      <input type="text" id="numero_alumno" placeholder="N¬∞ de alumno" />
      <input type="text" id="nombre" placeholder="Nombre" />
      <input type="text" id="apellido" placeholder="Apellido" />
      <input type="text" id="dni" placeholder="DNI" />
      <input type="text" id="clase" placeholder="Clase" />
      <input type="text" id="telefono" placeholder="Tel√©fono" />
      <input type="date" id="fecha_nacimiento" />
      <input type="date" id="fecha_ingreso" />
      <label><input type="checkbox" id="activo" checked /> Activo</label>
      <button onclick="guardarAlumno()">Guardar</button>
      <button onclick="cerrarModal()">Cancelar</button>
    </div>
  </div>

  <script>
  function abrirModal() {
    document.getElementById("modal").style.display = "flex";
  }

  function cerrarModal() {
    document.getElementById("modal").style.display = "none";
  }

  async function guardarAlumno() {
    const data = {
      numero_alumno: document.getElementById("numero_alumno").value,
      nombre: document.getElementById("nombre").value,
      apellido: document.getElementById("apellido").value,
      dni: document.getElementById("dni").value,
      clase: document.getElementById("clase").value,
      telefono: document.getElementById("telefono").value,
      fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
      fecha_ingreso: document.getElementById("fecha_ingreso").value,
      activo: document.getElementById("activo").checked,
      foto_url: ""
    };

    const res = await fetch("/api/alumnos", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    if (res.ok) {
      cerrarModal();
      cargarAlumnos();
    } else {
      alert("Error al guardar");
    }
  }

  async function cargarAlumnos() {
    const res = await fetch('/api/alumnos');
    const alumnos = await res.json();
    const cuerpo = document.querySelector("#tabla-alumnos tbody");
    cuerpo.innerHTML = "";
    alumnos.forEach((a) => {
      if (!a.activo && !document.getElementById("ver_inactivos").checked) return;
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td>${a.numero_alumno}</td><td>${a.nombre}</td><td>${a.apellido}</td><td>${a.dni}</td>
        <td>${a.clase}</td><td>${a.telefono}</td><td>${a.fecha_nacimiento || ""}</td>
        <td>${a.fecha_ingreso || ""}</td><td>${a.activo ? "‚úÖ" : "‚ùå"}</td>
        <td>${a.foto_url ? '<img src="' + a.foto_url + '" width="40">' : ''}</td>
        <td><button onclick="editar(${a.id})">‚úèÔ∏è</button><button onclick="eliminar(${a.id})">üóëÔ∏è</button></td>
      `;
      cuerpo.appendChild(fila);
    });
  }

  function editar(id) {
    alert("Funci√≥n de edici√≥n a√∫n no implementada");
  }

  function eliminar(id) {
    alert("Funci√≥n de eliminaci√≥n a√∫n no implementada");
  }

  document.getElementById("ver_inactivos").addEventListener("change", cargarAlumnos);
  window.addEventListener("load", cargarAlumnos);
</script>
</body>
</html>

